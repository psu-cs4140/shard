<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="csrf-token" content={Plug.CSRFProtection.get_csrf_token()} />

    <.live_title suffix=" · Shard">
      {assigns[:page_title] || "Shard"}
    </.live_title>

    <link phx-track-static rel="stylesheet" href={~p"/assets/app.css"} />
    <script defer phx-track-static type="text/javascript" src={~p"/assets/js/app.js"}>
    </script>
  </head>
  <body class="min-h-screen bg-base-100">
    <header class="navbar bg-base-200 px-4">
      <div class="flex-1">
        <.link href={~p"/"} class="btn btn-ghost text-lg font-semibold">Shard</.link>
      </div>

      <nav class="flex-none space-x-2">
        <.link href={~p"/music"} class="btn btn-ghost">Music</.link>

        <%= if @current_user do %>
          <!-- show email so controller tests can assert response =~ user.email -->
          <span class="text-sm opacity-70">{@current_user.email}</span>

          <.link href={~p"/users/settings"} class="btn btn-ghost">Settings</.link>
          <.link href={~p"/admin"} class="btn btn-ghost">Admin</.link>
          
<!-- core <.link method="delete"> renders <a ... data-method="delete" ...> -->
          <.link href={~p"/users/log_out"} method="delete" class="btn">Log out</.link>
        <% else %>
          <.link navigate={~p"/users/register"} class="btn btn-ghost">Register</.link>
          <.link navigate={~p"/users/log_in"} class="btn">Log in</.link>
        <% end %>
      </nav>
    </header>

    <main class="container mx-auto p-4">
      <.flash kind={:info} flash={@flash} />
      <.flash kind={:error} flash={@flash} />
      {@inner_content}
    </main>
    
<!-- LiveView hook target for server-controlled room music -->
    <div id="room-music" phx-hook="RoomMusic" aria-hidden="true" class="hidden"></div>

    <footer class="mt-8 border-t border-base-300 bg-base-200/50">
      <div class="container mx-auto px-4 py-3 text-sm text-base-content/60">
        <span>Some background music may be licensed; see </span>
        <.link href={~p"/credits"} class="link link-hover">Credits</.link>
        <span class="mx-1">·</span>
        <span>
          Example track in dev: “Sneaky Snitch” — Kevin MacLeod (incompetech.com), CC BY 3.0.
        </span>
      </div>
    </footer>
  </body>
</html>
